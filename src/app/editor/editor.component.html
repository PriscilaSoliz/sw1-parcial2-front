<div class="toolbar">
    <button (click)="editor.runCommand('core:undo')">â†©ï¸ Deshacer</button>
    <button (click)="editor.runCommand('core:redo')">â†ªï¸ Rehacer</button>
    <button (click)="guardarContenido()">ğŸ’¾ Guardar</button>
    <button (click)="abrirModalGemini()">ğŸ–¼ï¸ Generar desde Imagen</button>
    <!--<button (click)="abrirModalSql()">ğŸ› ï¸ Generar desde SQL</button>--> 
    <!--<button (click)="abrirModalExportar()">ğŸ“¦ Exportar Angular</button>--> 
    <button (click)="abrirModalXMI()">ğŸ—‚ï¸ Subir Diagrama XMI</button>
    <button (click)="abrirModalPrompt()">ğŸ’¡ Escribir Prompt</button>
    <!-- ğŸ“¦ BotÃ³n para exportar el proyecto Flutter completo -->
    <button (click)="exportarFlutterDesdeEditor()">ğŸ“¦ Exportar Proyecto Flutter</button> <!--puse el botton de exportar flutter--> 
</div>

<!-- Resto igual -->
<div class="editor-wrapper">
    <div id="blocks" class="panel blocks-panel"></div>
    <div id="gjs" class="main-canvas"></div>
    <div class="panel-side">
        <div id="layers" class="panel layers-panel"></div>
        <div id="styles" class="panel styles-panel"></div>
        <div id="traits" class="panel traits-panel"></div>
        <div id="selectors" class="panel selectors-panel"></div>
    </div>
</div>

<app-chat-gemini *ngIf="editor" [editor]="editor"></app-chat-gemini>
<app-sql-generate *ngIf="editor"></app-sql-generate>

<div class="modal-exportar" *ngIf="modalExportarAbierto">
    <div class="modal-content-exportar">
        <h2>ğŸ“¦ Exportar Angular</h2>
    
        <h3>HTML</h3>
        <textarea readonly [value]="htmlExportado"></textarea>
    
        <h3>CSS</h3>
        <textarea readonly [value]="cssExportado"></textarea>
    
        <h3>TypeScript</h3>
        <textarea readonly [value]="tsExportado"></textarea>
    
        <div class="botones-modal">
            <button (click)="descargarArchivos()">â¬‡ï¸ Descargar Archivos</button>
            <button (click)="cerrarModalExportar()">âŒ Cerrar</button>
        </div>
    </div>
</div> 

<!-- â‡¨ MODIFICADO: modal de exportaciÃ³n ahora muestra Dart -->
<div class="modal-exportar" *ngIf="modalExportarAbierto">
  <div class="modal-content-exportar">
    <h2>ğŸ“¦ CÃ³digo Flutter Generado</h2>
    <textarea readonly rows="15" style="width:100%">{{ dartExportado }}</textarea>
    <div class="botones-modal">
      <button (click)="descargarArchivos()">â¬‡ï¸ Descargar mi_widget.dart</button>
      <button (click)="cerrarModalExportar()">âŒ Cerrar</button>
    </div>
  </div>
</div>

<!-- â‡¨ NUEVO: Modal de progreso mientras se exporta Flutter -->
<div 
  *ngIf="cargando" 
  style="
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  ">
  <div style="
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    font-size: 1.2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  ">
    â³ Exportando Flutterâ€¦ por favor espera
  </div>
</div>

<!-- â‡¨ MODIFICADO: modal de exportaciÃ³n ahora muestra Dart -->
<div class="modal-exportar" *ngIf="modalExportarAbierto">
  <div class="modal-content-exportar">
    <h2>ğŸ“¦ CÃ³digo Flutter Generado</h2>
    <textarea readonly rows="15" style="width:100%">{{ dartExportado }}</textarea>
    <div class="botones-modal">
      <button (click)="descargarArchivos()">â¬‡ï¸ Descargar mi_widget.dart</button>
      <button (click)="cerrarModalExportar()">âŒ Cerrar</button>
    </div>
  </div>
</div>


<div class="xmi-modal-backdrop" *ngIf="modalXmiAbierto">
    <div class="xmi-modal">
        <h2>ğŸ—‚ï¸ Subir Diagrama XMI</h2>
        <input type="file" (change)="procesarXMI($event)" accept=".xmi,.xml">
        <div class="modal-buttons">
            <button (click)="cerrarModalXMI()">âŒ Cancelar</button>
        </div>
        <div *ngIf="cargandoGeminiXMI">â³ Procesando XMI con Gemini...</div>
        <div *ngIf="mensajeGemini">{{ mensajeGemini }}</div>
    </div>
</div>

<div class="modal-prompt" *ngIf="mostrarPrompt">
  <div class="modal-content">
    <h3>ğŸ§  Escribir Prompt para la IA</h3>

    <!-- Mostrar "Cargando..." mientras se espera respuesta -->
    <div *ngIf="cargando" style="margin-bottom: 10px; color: #3498db; font-weight: bold;">
      â³ Cargando respuesta de la IA...
    </div>

    <textarea [(ngModel)]="prompt" rows="6" placeholder="Escribe tu idea..." [disabled]="cargando"></textarea>

    <div class="modal-actions">
      <button (click)="enviarPrompt()" [disabled]="cargando">Enviar</button>
      <button (click)="cerrarModalPrompt()" [disabled]="cargando">Cancelar</button>
    </div>
  </div>
</div>
